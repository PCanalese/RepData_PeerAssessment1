---
title: "Reproducible Research: Peer Assessment 1"
author: Philip Canalese
revision: 0.2 - 5 June 2015
output: 
  html_document:
    keep_md: true
---
## Context

The document is Peer Assessment 1 for the Johns Hopkins University Cousera Programme - Reproducible Research.

It uses data downloaded from the course web site:

* Dataset: [Activity monitoring data](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip) [52K]

For this assessment the data was downloaded from the above website on Jun 3 2015.

The SHA-1 hash for the downloaded zip file was:
02eb450a51703750115ccb63efada91b2ec49bb0

The following steps was carried on the extract data file "activity.csv"

## Loading and preprocessing the data
For the purposes of simplification, it is assumed that persons reproducing this work have the ability to download the file and store it in an appropriate location on their system.

Load the data and convert it to a seperate data table. The step of saving in the data in a new frame is not required but enables the data to be manipulate with having to re read the data in.  Given the data set is not huge memory should not be an issue.

```{r echo=TRUE}

library(data.table)

raw_data = read.table("./activity/activity.csv", header = TRUE, sep=",", 
                   colClasses=c('integer','Date','integer'))

#convert to data table
data_dt = as.data.table(raw_data)
setkey(data_dt, date)

```



## What is mean total number of steps taken per day?

Step 1: Make a histogram of the total number of steps per day
Note that NA values have been left in and no changes have been made to their value, 
as we have no idea on what the total number of steps taken on these days.

```{r echo=TRUE}

# extract daily totals
data_dt_days = data_dt[,lapply(.SD,sum), by = date, .SD="steps"]
setnames(data_dt_days,2,"steps")

#Plot histogram with 20 intervals
hist(data_dt_days$steps,20, 
     main=paste0("Histogram of Total Number of Steps per day ",data_dt$date[1],
                 " to ", data_dt$date[17568]), 
     col="Light Blue",
     xlab ="Steps",
     xlim = c(0,25000), ylim = c(0,12))

```

Step 2: Calculate and report the mean and median total number of steps taken per day


```{r echo=TRUE}
# note NA removed so mean and median are only on days that have data

# Calculate mean 
data_dt_days[,mean(steps,na.rm = TRUE),]
# Calculate median
data_dt_days[,median(steps,na.rm = TRUE),]

```

The mean and median number of steps are close and note days where no data has been recorded have not been included.

## What is the average daily activity pattern?

Step 1 Make a time series plot of the 5-minute interval and the average number of steps taken, averaged across all days

```{r echo=TRUE}

# calculate the average of 5 minute time slots over all days
data_dt_intervals = tapply(data_dt$steps,as.factor(data_dt$interval),mean,na.rm=TRUE)

#plot the data
plot(rownames(data_dt_intervals),data_dt_intervals,type='l',
     main=paste0("Average Steps per 5 minute Interval ",data_dt$date[1]," to ",
                 data_dt$date[17568]),
     col= "Dark Blue",
     xlab="5 minute Interval",
     ylab="Average Steps")

```

Step 2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

```{r echo=TRUE}
#return which period has the maximum mean value
data_dt_intervals[which(data_dt_intervals==(max(data_dt_intervals)))]

```



## Imputing missing values

Step 1. Calculate and report the total number of missing values in the dataset

```{r echo=TRUE}
# Determine the number of rows that have NA
data_dt[is.na(steps)]

```

It is noted that given the total number of 5 minute periods in any one day is (24*60)/5 = 288 periods and from above there are 2304 intervals, the number of days with no data is 2304/288 = 8 days (exactly) and the dates of these are given below:

```{r echo=TRUE}
# Show days that have NA
data_dt_days[is.na(steps)]
```


Step 2 & 3. Devise a strategy for filling in all of the missing values in the dataset.
The method used was to replace the NA value with the average value of the 5 minute 
interval accross all days for the interval in question.

```{r echo=TRUE}

# replace the NA in data set with average values for 5 minute intervals
data_dt_nas = data_dt
for (i in 1:nrow(data_dt_nas)){
        if (is.na(data_dt_nas$steps[i])) {
                data_dt_nas$steps[i]=
                        data_dt_intervals[which(row.names(data_dt_intervals)==data_dt_nas$interval[i])]
        }
}

```

Step 4 Make a histogram of the total number of steps taken each day and Calculate
and report the mean and median total number of steps taken per day.

```{r echo=TRUE}
# Make a histogram and calculate mean and median
#Plot histogram with 20 intervals

data_dt_nas_days = data_dt_nas[,lapply(.SD,sum), by = date, .SD="steps"]
hist(data_dt_nas_days$steps,20, 
     main=paste0("Histogram of Total Number of Steps per day ",data_dt$date[1],
                 " to ", data_dt$date[17568]),
     col="Light Blue",
     xlab ="Steps",
     xlim = c(0,25000), ylim = c(0,20))

# Calculate mean 
data_dt_nas_days[,mean(steps),]
# Calculate median
data_dt_nas_days[,median(steps),]

```
It is noted that the median and mean values are now equal and that the median value is no longer an integer as the average values inserted in the above process were not rounded in any way.

These values differ from the values calculated above by.

```{r echo=TRUE}
# Delta to original set
data_dt_days[,mean(steps,na.rm = TRUE),]-data_dt_nas_days[,mean(steps),]
data_dt_days[,median(steps,na.rm = TRUE),]-data_dt_nas_days[,median(steps),]

```
Total number of steps of the adjusted set has increased as shown below:

```{r echo=t}
# Calculate the total number of steps diference
sum(data_dt_nas_days$steps)-sum(na.omit(data_dt_days$steps))

```



## Are there differences in activity patterns between weekdays and weekends?

Step 1. Create a new factor variable in the dataset with two levels -- "weekday" and "weekend" indicating whether a given date is a weekday or weekend day.

```{r echo=TRUE}

#Difference between Weekday and weekend
# Get new column and populate with day names
data_dt_nas$day_col = weekdays(strptime(data_dt_nas$date, format = "%Y-%m-%d"))
# New factor column and populate with weekend or weekday
data_dt_nas$day_col_week = factor(ifelse(data_dt_nas$day_col == "Saturday" | 
                                                 data_dt_nas$day_col == "Sunday", "weekend", "weekday"), 
                                  levels = c("weekday", "weekend"))

```

Step 2.Plot the two graphs of weekday and weekend over 5 minute interval.

```{r echo=t}
library(ggplot2)
# plot each of the point sources using ggplot
data_source <- data_dt_nas[,lapply(.SD,mean), by=list(interval,day_col_week), .SDcols = "steps"]

g <- ggplot(data_source, aes(interval,steps)) # Set the data

# plot used as data refers to only the years in question
g + geom_line(stat="identity") + facet_grid(day_col_week~.) + 
        labs(title = "Average Steps by interval",
             y = "Average Number of Steps", x="Time Interval") +
        theme(axis.text.x = element_text(angle = 90, vjust=0.5)) # add the elements


```

From the graphs we can see that the person starts walking earlier on a weekday.  Perhaps this indicates a person working to work or transport to work, perhaps they walk a pet on the weekdays but not on the weekend - we can't tell from just this data.
It also seems that on weekends during the period 10 am to 7:30 pm the average number of steps is around 75 steps per period compared with around 50 steps per period for the same time during the week.
